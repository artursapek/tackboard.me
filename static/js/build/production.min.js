(function(){var h,m,i,f,r,k,l,g,n,o,p,j,q,s=[].indexOf||function(a){for(var b=0,c=this.length;b<c;b++)if(b in this&&this[b]===a)return b;return-1};i=function(a){return console.log(null!=a?a:"!")};f=function(a,b,c,d){var e,f,a=document.createElement(a);for(e in b)f=b[e],a[e]=f;null!=c&&(a.innerHTML=c);if(null!=d){c=0;for(e=d.length;c<e;c++)b=d[c],a.appendChild(b)}return a};m=function(a){var b,c,d,e;e=[];c=0;for(d=a.length;c<d;c++)b=a[c],e.push(b[0].appendChild(b[1]));return e};n=function(a,b){var c;
null==b&&(b=0);c=new Image;if(b!==a.length)return c.onload=function(){return n(a,b+1)},c.src=a[b]};window.c=i;window.create=f;window.appendobj=m;window.preload=n;l=function(){function a(b){var a,d,e;this.data=b;d=this;for(a in b)e=b[a],this[a]=e;this.dragging=this.lifted=!1;this.tack_color=null!=b.tack_color?b.tack_color:"B";this.all=f("div",{className:"poster_all",id:"poster_"+b.id});null!=b.id&&$(this.all).attr("pid",b.id);$(this.all).css({left:b.x+"px",bottom:b.y+"px","z-index":b.id}).mouseover(function(){if(!d.lifted&&
!d.dragging)return window.user_interacted=!0,$(d.age_div).show(),$(d.tear_button).show(),!0}).mouseout(function(){$(d.age_div).hide();return $(d.tear_button).hide()});this.page=f("div",{className:"poster_page"});this.body=f("div",{className:"poster_text"},b.body);this.tack=f("div",{className:"poster_tack"});$(this.tack).css({"background-color":tack_colors[this.tack_color]});m([[this.all,this.page],[this.all,this.body],[this.all,this.tack]]);1E6!==b.id&&(window["poster_"+b.id]=this);return this}a.prototype.lift=
function(){var a;a=this;this.lifted=!0;$([this.lift_button,this.age_div,this.lifted_corner,this.tear_button,this.body]).each(function(){return $(this).hide()});$(this.unlift_button).show();$(this.page).attr("class","poster_page_lifted").animate({bottom:"+=7px"},0).css({"background-position":"0px 0px"});$(this.tack).animate({bottom:"-=261px"},0);$(this.all).animate({bottom:"+=261px"},0).animate({opacity:"0.65"},500).mouseover(function(){if(a.lifted)return $(this).animate({opacity:"1"},0)}).mouseout(function(){if(a.lifted)return $(this).animate({opacity:"0.65"},
0)}).addClass("poster_all_lifted");return!0};a.prototype.unlift=function(){this.lifted=!1;$([this.lift_button,this.tear_button,this.body]).each(function(){return $(this).show()});$(this.page).animate({bottom:"0px"},0).css("background-position","0px 0px").attr({"class":"poster_page"});$(this.all).animate({bottom:"-=261px",opacity:1},0).removeClass("poster_all_lifted");$(this.tack).animate({bottom:"+=261px"},0);$(this.unlift_button).hide();return!0};a.prototype.tear=function(){var a;a=this;if(!this.active)return!1;
"undefined"!==typeof do_ajax&&null!==do_ajax||h.tear({id:this.id});this.unarm_tear();$([this.tear_button,this.age_div]).each(function(){return $(this).remove()});$([this.lift_button,this.lifted_corner]).each(function(){return $(this).hide()});$(this.all).css({"pointer-events":"none"});setTimeout(function(){$([a.page,a.body]).each(function(){return $(this).animate({top:"+=100px"},1500,"easeOutExpo").fadeOut(500)});return setTimeout(function(){return $(a.all).css({width:"0px",height:"0px"})},2100)},
200);this.active=!1;return all_posters.splice(all_posters.indexOf(this),1)};a.prototype.arm_tear=function(){var a;a=$(this.all).offset();this.unarm_others();$(this.age_div).hide();$(tear_confirm).css({top:parseInt(a.top)-10+"px",left:parseInt(a.left)-15+"px"}).show().attr({armed:this.id});return $(this.tear_fog).fadeIn(50)};a.prototype.unarm_others=function(){var a,c,d,e;e=[];c=0;for(d=all_posters.length;c<d;c++)a=all_posters[c],a!==this?e.push($(a.tear_fog).fadeOut(50)):e.push(void 0);return e};
a.prototype.unarm_tear=function(){$(tear_confirm).fadeOut(100);return $(this.tear_fog).fadeOut(50)};a.prototype.post=function(a){var c;null==a&&(a=!1);c=this;this.lift_button=f("div",{className:"lift_target"});this.unlift_button=f("div",{className:"unlift_target"});this.lifted_corner=f("div",{className:"lifted_corner"});this.tear_button=f("div",{className:"tear_button"});this.tear_fog=f("div",{className:"tear_fog"});this.age_div=f("div",{className:"poster_age"},this.age);$(this.tear_button).click(function(){return c.arm_tear()}).hide();
$([this.unlift_button,this.age_div,this.lifted_corner,this.lift_button,this.tear_button,this.tear_fog]).each(function(){return $(c.all).append(this)});$("#tackboard").append(this.all);$(this.lift_button).click(function(){return c.lift()}).mouseover(function(){$(c.page).css({"background-position":"0px -316px"});return $(c.lifted_corner).show()}).mouseout(function(){$(c.page).css({"background-position":"0px 0px"});return $(c.lifted_corner).hide()});$(this.unlift_button).click(function(){return c.unlift()}).mouseover(function(){return $(c.page).css({"background-position":"0px -70px"})}).mouseout(function(){return $(c.page).css({"background-position":"0px 0px"})});
a&&($(this.tack).hide(),setTimeout(function(){return $(c.tack).css({background:tack_colors[c.tack_color]}).animate({width:"20px",height:"20px",left:"-=7px",bottom:"-=7px"},0).fadeIn(100).delay(400).animate({width:"6px",height:"6px",left:"+=7px",bottom:"+=7px"},200)},500));return!0};return a}();p=function(){function a(a){this.tack=f("div",{className:"tack_only"});$(this.tack).css({left:a.x+120+"px",bottom:a.y+293+"px","background-color":tack_colors[a.tack_color],"z-index":1});window["tack_"+a.id]=
this}a.prototype.post=function(){return $("#tackboard").append(this.tack)};return a}();window.poster=l;window.tack_only=p;window.tack_colors={B:"#41b2f2",R:"#f23b4c",G:"#32b221",P:"#eb6e96",W:"#c3c3c3"};$(document).ready(function(){var a,b,c,d;window.all_posters=[];window.all_tacks=[];window.statuses={};window.ignore_stats=!1;window.user_interacted=!1;window.keep_categories=!1;document.location.hash?o(!0):h.all();n(["/static/img/peek_behind.png"],0);$("#edit_me").wysiwyg();$("#editor").append(f("div",
{id:"close_button"})).append(f("div",{id:"save_button"}));$("#save_button").click(function(){return j.draggable_poster()});$("#close_button").click(function(){return q()});$(document).bind("paste",function(){return g.clean_up()});c=f("div",{className:"tear_conf"});b=f("div",{className:"tear_conf_prompt"},"<b>Permanently</b> remove?");d=f("div",{className:"tear_opt_yes"},"Remove");a=f("div",{className:"tear_opt_no"},"Cancel");$(d).click(function(){return window["poster_"+c.getAttribute("armed")].tear()});
$(a).click(function(){return window["poster_"+c.getAttribute("armed")].unarm_tear()});$([b,d,a]).each(function(){return $(c).append(this)});$("body").append(c);window.tear_confirm=c;j.reset_category_dropdown();$("#category_dropdown").css("left",$("#tackboard_logo").width()+$("#board_name").width()+52+"px");$("#category_dropdown_button").unbind().mouseover(function(){window.keep_categories=!0;$(this).addClass("category_hover");return $("#category_dropdown").css({display:"inline-block"})}).mouseout(function(){window.keep_categories=
!1;return setTimeout(function(){if(!window.keep_categories)return $("#category_dropdown").hide(),$("#category_dropdown_button").removeClass("category_hover")},200)});$("#category_dropdown").unbind().mouseover(function(){return window.keep_categories=!0}).mouseout(function(){window.keep_categories=!1;return setTimeout(function(){if(!window.keep_categories)return $("#category_dropdown").hide(),$("#category_dropdown_button").removeClass("category_hover")},200)});$(window).hashchange(function(){return o(!0)});
r();return!0});h={all:function(){return $.get("/ajax/active_posters?board_id="+board_id+"&category="+current_category).done(function(a){var b,c,d,a=$.parseJSON(a)[0];for(c in a)b=a[c],d=b.active?new l(b):new p(b),d.post(!1),b.active?all_posters.push(d):all_tacks.push(d),statuses[c]=b.active;return j.reset_category_dropdown()})},post:function(a,b){return $.ajax({type:"POST",url:"/ajax/add_poster/",data:{csrfmiddlewaretoken:csrf_token,board_id:board_id,x:a.x,y:a.y,tack_color:a.color,body:a.body,category:current_category}}).done(function(c){a=
$.parseJSON(c)[1];b.id=a.id;$(b.all).css({"z-index":a.id}).attr({id:"poster_"+a.id,pid:a.id});statuses[a.id]=a.active;window["poster_"+a.id]=b;return j.reset_category_dropdown()})},tear:function(a){return $.ajax({type:"POST",url:"/ajax/remove_poster/",data:{csrfmiddlewaretoken:csrf_token,poster_id:a.id}})},update:function(){return $.get("/ajax/update/?board_id="+board_id+"&category="+current_category).done(function(a){var b,c;c=$.parseJSON(a)[0];a=window.statuses;for(b in c)null==a[b]?h.add(b):!a[b]===
c[b]&&window["poster_"+b].tear(!1);return window.statuses=c})},add:function(a){return $.get("/ajax/retrieve_poster/?poster_id="+a).done(function(a){a=$.parseJSON(a)[0];return a.active?(a=new l(a),a.post(!0)):(new p(a)).post()})},"switch":function(a,b,c){var d,e;null==b&&(b=!0);null==c&&(c=!1);j.clear_board();$("#category_dropdown_button").removeClass("category_hover").text(a);$("#category_dropdown").hide().empty();d=0;for(e=categories.length;d<e;d++)i=categories[d],i!==a&&$("#category_dropdown").append($("<li onclick=\"ajax.switch($(this).text()); ajax.reference('Switched category');\">"+
i+"</li>"));window.current_category=a;c&&h.all();if(b)return document.location="#"+a.toLowerCase().match(/\w+/gi).join("")},reference:function(a){if(!ignore_stats)return $.ajax({type:"POST",url:"/ajax/reference_counter",data:{csrfmiddlewaretoken:csrf_token,action:a}})}};j={"switch":function(a){return document.location="#"+a.match(/\w+/gi).join("").toLowerCase()},clear_board:function(){var a,b,c;b=0;for(c=all_posters.length;b<c;b++)a=all_posters[b],$(a.all).remove();b=0;for(c=all_tacks.length;b<c;b++)a=
all_tacks[b],$(a.tack).remove();window.all_posters=[];return window.all_tacks=[]},reset_category_dropdown:function(){return $("#category_dropdown").css("min-width",$("#category_dropdown_button").width()+26+"px")},draggable_poster:function(){var a;$("#edit_me-wysiwyg-iframe").hide();a=new l({body:g.html(),x:77,y:112,id:1E6,tack_color:"B",active:!0,age:"just now"});a.body_html=g.html();a.post();$([a.tack,a.tear_button,a.lift_button]).each(function(){return $(this).hide()});a.dragging=!0;a.drag_icon=
f("div",{className:"drag_icon"});a.tack_dialog=f("div",{className:"tack_dialog_full"});a.tack_prompt=f("div",{className:"tack_prompt_1"},"Drag your poster to where you want to post it.");a.tack_options=f("div",{className:"tack_options"});$(a.tack_dialog).append(a.tack_prompt);$(a.all).append(a.drag_icon).append(a.tack_dialog).css("cursor","pointer").one("mousedown",function(){var b,c,d,e;$(a.tack_prompt).text("Choose tack color to post.").attr("class","tack_prompt_2");$(a.tack_dialog).append(a.tack_options);
e=[];for(b in tack_colors)c=f("div",{className:"tack_option"}),d=f("div",{className:"poster_tack"}),$(d).css({top:"12px",left:"12px",background:tack_colors[b]}),$(c).attr({color:b}).mouseover(function(){$(".tack_option").each(function(){return $(this).css({opacity:"0.25"})});return $(this).css({opacity:"1"})}).mouseout(function(){return $(".tack_option").each(function(){return $(this).css({opacity:1})})}).click(function(){$(a.tack_dialog).remove();$(a.all).css({cursor:""});a.dragging=!1;g.lock_opts=
!1;a.commit(this.getAttribute("color"));return setTimeout(function(){return $("#add_button").fadeIn(500)},2E3)}),$(c).append(d),e.push($(a.tack_options).append(c));return e});g.drag_handler.attach(a.all);$(g).hide();g.lock_opts=!0;$("#add_button").hide();q();return a.commit=function(b){var c;c=this;this.x=parseInt($(a.all).css("left"));this.y=parseInt($(a.all).css("bottom"));$(this.drag_icon).fadeOut(100);$(this.tear_button).hide();setTimeout(function(){return $(c.tack).css("background",tack_colors[b]).animate({width:"20px",
height:"20px",left:"-=7px",bottom:"-=7px"},0).fadeIn(100).delay(400).animate({width:"6px",height:"6px",left:"+=7px",bottom:"+=7px"},200)},$(this.lift_button).show(),500);h.post({x:this.x,y:this.y,color:b,body:this.body_html},this);all_posters.push(this);return g.body().innerHTML=""}}};g={html:function(){var a,b,c,d,e,f,g;a=$("#edit_me-wysiwyg-iframe")[0].contentDocument.getElementsByTagName("body")[0].innerHTML;d=a.match(/[\w\d\.\/\:\@]+\.(com|net|org|info|me|mobi|co.uk|co|in|us|ca|edu)/gi);c=a.match(/[\w\d\.\-\_\:]+\@[\w\d\.\-\_\:]+\.(com|net|org|info|me|mobi|co.uk|co|in|us|ca|edu)/gi);
if(d){f=0;for(g=d.length;f<g;f++)e=d[f],0<=s.call(e,"@")||(b=0<=s.call(e,"http://")?e:"http://"+e,a=a.replace(e,'<a href="'+b+'" target="_newtab">'+e+"</a>"))}if(c){d=0;for(e=c.length;d<e;d++)b=c[d],a=a.replace(b,'<a href="mailto:'+b+'" target="_newtab">'+b+"</a>")}return a},body:function(){return $("#edit_me-wysiwyg-iframe")[0].contentDocument.getElementsByTagName("body")[0]},clean_up:function(a){var b,c,d,e;null==a&&this.html();a=["<a.*</a>","<script.*<\/script>","<img.*/>","<span.*</span>","<div[^>].*</div>"];
d=0;for(e=a.length;d<e;d++){c=a[d];for(c=RegExp(c,"gi");b.match(c);)b=b.replace(b.match(c)[0],"")}return this.body().innerHTML=b},hide:function(){$(this.body()).hide();return $("#editable_poster").css("background","none")},drag_handler:{_me:null,attach:function(a){a.onmousedown=g.drag_handler._dragBegin;a.dragBegin=new Function;a.drag=new Function;a.dragEnd=new Function;return a},_dragBegin:function(a){var b,c,d;b=g.drag_handler._me=this;isNaN(parseInt(b.style.left))&&(b.style.left="0px");isNaN(parseInt(b.style.bottom))&&
(b.style.bottom="0px");c=parseInt(b.style.left);d=parseInt(b.style.bottom);a=a?a:window.event;b.mouseX=a.clientX;b.mouseY=a.clientY;b.dragBegin(b,c,d);document.onmousemove=g.drag_handler._drag;document.onmouseup=g.drag_handler._dragEnd;return!1},_drag:function(a){var b,c,d;if(g.lock_opts)return b=g.drag_handler._me,c=parseInt(b.style.left),d=parseInt(b.style.bottom),a=a?a:window.event,b.style.left=Math.max(Math.min(c+(a.clientX-b.mouseX),929),5)+"px",b.style.bottom=Math.min(Math.max(d+(b.mouseY-a.clientY),
10),364)+"px",b.mouseX=a.clientX,b.mouseY=a.clientY,b.drag(b,c,d),!1},_dragEnd:function(){var a,b,c;a=g.drag_handler._me;b=parseInt(a.style.left);c=parseInt(a.style.bottom);a.dragEnd(a,b,c);return document.onmousemove=document.onmouseup=g.drag_handler._me=null}},lock_opts:!1,open:!1};o=function(a){var b,c,d,e,f;null==a&&(a=!1);c=document.location.hash.substring(1);if(""===c)h["switch"](default_category,!1,!0);f=[];d=0;for(e=categories.length;d<e;d++)i=categories[d],b=i.toLowerCase().match(/\w+/gi).join(""),
b===c?i!==current_category?f.push(h["switch"](i,!1,a)):f.push(h.all()):f.push(void 0);return f};r=function(){setTimeout(function(){if(!window.user_interacted)return $(".lifted_corner").each(function(){return $(this).show()}),$(".poster_age").each(function(){return $(this).hide()}),$(".tear_button").each(function(){return $(this).css({"background-position":"0px -37px"}).show()}),$(".poster_page").each(function(){return $(this).css({"background-position":"0px -316px"})})},3E3);return setTimeout(function(){if(!window.user_interacted)return $(".lifted_corner").each(function(){return $(this).hide()}),
$(".tear_button").each(function(){return $(this).css({"background-position":""}).hide()}),$(".poster_page").each(function(){return $(this).css({"background-position":""})})},3800)};q=function(){window.user_interacted=!0;if(g.open)return $("#close_button, #save_button, #editor").animate({bottom:"-=530px"},150,"easeOutQuad"),$("#close_button, #save_button").fadeOut(300),setTimeout(function(){return g.open=!1},300);$("#edit_me-wysiwyg-iframe").show();$("#editor, #close_button, #save_button").animate({bottom:"+=530px"},
450,"easeOutElasticMinimal");setTimeout(function(){return $("#save_button, #close_button").fadeIn(100)},700);return setTimeout(function(){return g.open=!0},300)};k=function(a,b,c,d){null==a&&(a=0);[function(){var a;a=$(d.all).offset();$(d.page).css({"background-position":"0px -316px"});$(d.lifted_corner).show();return $(b).css({left:a.left+250+"px",top:a.top+260+"px"})},function(){var a;a=$(d.all).offset();$(d.lifted_corner).hide();$(d.tear_button).show().css({"background-position":"0px -37px"});
$(d.page).css({"background-position":"0px 0px"});return $(b).css({top:a.top-34+"px"})},function(){var a;a=$("#add_button").offset();null!=d&&$(d.tear_button).css("background-position","");$("#add_button").addClass("add_button_show");return $(b).css({top:a.top-5+"px",left:a.left-190})},function(){var a,c;a=$("#category_dropdown").offset();c=$("#category_dropdown").width();$("#category_dropdown").css("display","inline-block");$("#category_dropdown_button").addClass("category_hover");$("#add_button").removeClass("add_button_show");
return $(b).css({top:a.top+60+"px",left:a.left+c+460+"px"})},function(){setTimeout(function(){$("#category_dropdown").fadeOut(200);return $("#category_dropdown_button").removeClass("category_hover")},200);return $(b).remove()}][a].call(this);if(4===a)return!0;b.id="help_dialog_"+a;c.id="help_dialog_text_"+a;c.innerHTML=['Lift up posters to look underneath.<br><br><span id="click_to_continue">(click me to continue)</span>','You can also take down posters if you have good reason.<br><br>(Spam, outdated, etc.)<br><br><span id="click_to_continue">(click me to continue)</span>',
'You can add your <br>own poster here.<br><br><span id="click_to_continue">(click me to continue)</span>','Switch between the different<br>categories available here. Have fun!<br><br><span id="click_to_continue">(click me to close)</span>'][a];$(b).append(c).hide().click(function(){return k(a+1,b,c,d)});return setTimeout(function(){return $(b).fadeIn(140)},100)};window.ajax=h;window.tackboard=j;window.poster_editor=g;window.flash_UI=r;window.read_hash=o;window.init_paste=function(a){a=a.contentWindow.document;
if(a.getElementsByTagName("body").length)return $(a.body).bind("paste",function(){return!1})};window.help=function(){var a,b,c,d,e,h;for(e=h=0;4>=h;e=++h)$("#help_dialog_"+e).remove();a=all_posters[all_posters.length-1];b=f("div",{className:"help_dialog"});c=f("div",{id:"help_dialog_text_1"});d=0;m([[$("body")[0],b],[b,c]]);null==a&&(d=2);return g.open?setTimeout(function(){return k(d,b,c,a)},300):k(d,b,c,a)};window.help_steps=k;window.toggle_editor=q}).call(this);
